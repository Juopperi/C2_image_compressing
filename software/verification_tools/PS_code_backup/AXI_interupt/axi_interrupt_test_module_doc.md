# AXI 中断测试模块文档

## 模块概述

`axi_interrupt_test` 是一个基于 AXI4-Lite 总线协议的中断测试模块。该模块用于测试中断功能，实现了以下功能：

1. 通过 AXI 总线接收数据
2. 在接收到数据后启动延时计数器
3. 延时一秒后触发中断信号
4. 当主机读取数据时，返回原始数据

该模块是验证 AXI 总线中断机制的理想工具，可用于测试处理器或其他主设备对中断的响应能力。

## 接口定义

### 参数
- `C_S_AXI_DATA_WIDTH`：AXI 数据宽度，默认为 32 位
- `C_S_AXI_ADDR_WIDTH`：AXI 地址宽度，默认为 4 位

### 端口
- AXI4-Lite 从接口
  - 时钟和复位信号：`s_axi_aclk`, `s_axi_aresetn`
  - 写地址通道：`s_axi_awaddr`, `s_axi_awvalid`, `s_axi_awready`
  - 写数据通道：`s_axi_wdata`, `s_axi_wstrb`, `s_axi_wvalid`, `s_axi_wready`
  - 写响应通道：`s_axi_bresp`, `s_axi_bvalid`, `s_axi_bready`
  - 读地址通道：`s_axi_araddr`, `s_axi_arvalid`, `s_axi_arready`
  - 读数据通道：`s_axi_rdata`, `s_axi_rresp`, `s_axi_rvalid`, `s_axi_rready`
- 中断输出：`interrupt`

## 寄存器映射

模块包含以下四个 32 位寄存器：

| 偏移量 | 寄存器名称 | 访问类型 | 描述 |
|--------|------------|----------|------|
| 0x0    | DATA_REG   | 读/写    | 数据寄存器，存储接收到的数据 |
| 0x4    | CTRL_REG   | 读/写    | 控制寄存器，bit[0]用于清除中断，bit[1]用于复位状态机 |
| 0x8    | STATUS_REG | 只读     | 状态寄存器，bit[0]表示中断状态 |
| 0xC    | INT_ENABLE_REG | 读/写 | 中断使能寄存器，bit[0]用于使能中断 |

## 状态机

模块内部实现了一个状态机来控制中断流程：

- `IDLE`：空闲状态，等待数据写入
- `WAITING`：等待状态，在接收到数据后开始计数延时
- `INTERRUPT`：中断状态，当延时结束后触发中断信号
- `DONE`：完成状态，中断被清除后进入此状态，等待复位

## 使用方法

### 基本操作流程

1. **初始化**：复位模块，然后设置中断使能寄存器（写入 0x1 到 0xC 地址）
2. **发送数据**：向数据寄存器写入数据（写入数据到 0x0 地址）
3. **等待中断**：等待一秒后，模块会触发中断信号
4. **读取数据**：中断触发后，可以读取数据寄存器获取原始数据
5. **清除中断**：向控制寄存器写入 0x1（写入 0x1 到 0x4 地址）清除中断
6. **复位状态机**：向控制寄存器写入 0x2（写入 0x2 到 0x4 地址）使状态机返回 IDLE 状态

### 代码示例

```verilog
// 使能中断
axi_write(0xC, 32'h1);

// 写入数据
axi_write(0x0, 32'hA5A5A5A5);

// 等待中断触发
wait(interrupt);

// 读取数据
axi_read(0x0, read_data);

// 清除中断
axi_write(0x4, 32'h1);

// 复位状态机
axi_write(0x4, 32'h2);
```

## 时序要求

- 中断延时：默认为 1 秒（在 100MHz 时钟下为 100,000,000 个时钟周期）
- AXI 接口遵循标准 AXI4-Lite 总线协议时序要求

## 实现注意事项

1. 实际应用中，延时计数器 `DELAY_MAX` 参数需要根据实际时钟频率调整
2. 中断信号只有在中断使能寄存器 bit[0] 为 1 时才会输出
3. 在清除中断后，需要额外写入控制寄存器 bit[1] 才能重新开始中断流程
4. 该模块实现了完整的 AXI4-Lite 总线协议，确保正确的握手时序

## 仿真环境

提供了 `axi_interrupt_test_tb.v` 仿真测试文件，用于验证模块功能。仿真环境包括：

1. AXI 总线操作任务（axi_write 和 axi_read）
2. 完整的测试流程覆盖所有功能点
3. 中断信号监测和打印
4. 适当缩短的延时参数，加速仿真过程 